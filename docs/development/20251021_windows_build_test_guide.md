# Windows版ビルド・動作確認ガイド（2025-10-21）

**作成日**: 2025-10-21
**目的**: Windows版v1.1.1改善版のビルドと動作確認
**環境**: Parallels Desktop（Windows 11）

---

## 📋 作業の目的

以下の2点を確認します：

1. **クリップボードコピー検証処理削除後の動作確認**
   - 検証処理を削除しても、クリップボードコピーが正常に動作するか
   - ログに警告が表示されないか

2. **SSEハートビート機能の動作確認**
   - 2025-10-20に実装したSSEハートビート（10秒間隔）が正常動作するか
   - 長時間音声データで「エラー: Load failed」が発生しないか

---

## 🛠️ ビルド手順

### 前提条件

- Windows 11（Parallels Desktop）
- Python 3.12.x がインストール済み
- プロジェクトフォルダへのアクセス権限

### ステップ1: プロジェクトフォルダに移動

**コマンドプロンプト**または**PowerShell**を開いて以下を実行：

```cmd
cd /d D:\path\to\GaQ_app\release\windows
```

> **注意**: パスは実際のプロジェクト配置場所に合わせてください。
> Parallels共有フォルダを使用している場合は、`\\Mac\Home\Claude_Code\GaQ_app\release\windows` などになります。

### ステップ2: ビルドスクリプトを実行

```cmd
build.bat
```

**期待される出力**:

```
=== GaQ Offline Transcriber - Windows版ビルド ===

1. Pythonバージョン確認...
[OK] Python 3.12.x を使用します

2. 仮想環境の確認...
[OK] 既存の仮想環境を使用します

3. 依存パッケージのインストール...
[OK] 依存パッケージをインストールしました

PyInstaller: x.x.x

4. PyInstallerでビルド実行...
（ビルドログが表示される）

[OK] ビルドが成功しました！

成果物:
  dist\GaQ_Transcriber\GaQ_Transcriber.exe
```

### ステップ3: ビルド成果物の確認

```cmd
dir dist\GaQ_Transcriber\GaQ_Transcriber.exe
```

ファイルサイズが10MB以上あることを確認してください。

---

## ✅ 動作確認チェックリスト

### テスト1: 基本起動確認

**手順**:

1. エクスプローラーで `dist\GaQ_Transcriber\GaQ_Transcriber.exe` をダブルクリック
2. アプリが起動することを確認

**チェック項目**:
- [ ] アプリウィンドウが表示される
- [ ] タイトルに「GaQ Offline Transcriber」と表示される
- [ ] UIが正しく表示される（ファイル選択、モデル選択、文字起こしボタン）

**期待される結果**: アプリが正常に起動する

---

### テスト2: ファイル選択

**手順**:

1. 「音声ファイルをドラッグ&ドロップ または クリックして選択」エリアをクリック
2. 任意の音声ファイル（mp3、wav、m4aなど）を選択

**チェック項目**:
- [ ] ファイル選択ダイアログが開く
- [ ] ファイルを選択すると、ファイル名が表示される
- [ ] 「文字起こし開始」ボタンが有効化される

**期待される結果**: ファイル選択が正常に動作する

---

### テスト3: 短時間音声での文字起こし

**手順**:

1. 短い音声ファイル（1分程度）を選択
2. 「文字起こし開始」ボタンをクリック
3. 文字起こしが完了するまで待つ

**チェック項目**:
- [ ] プログレスバーが表示される
- [ ] 進捗が更新される（5% → 10% → ... → 100%）
- [ ] 文字起こし結果が表示される
- [ ] 文字数と処理時間が表示される

**期待される結果**: 文字起こしが正常に完了する

---

### テスト4: クリップボードコピー（重要）

**手順**:

1. テスト3で文字起こしした結果が表示されている状態
2. 「📋 コピー」ボタンをクリック
3. メモ帳（Notepad）を開く
4. Ctrl+V でペースト

**チェック項目**:
- [ ] 「✓ クリップボードにコピーしました」というトースト通知が表示される
- [ ] メモ帳にペーストすると、文字起こし結果が正しく貼り付けられる
- [ ] 文字化けしていない
- [ ] 改行が正しく保持されている

**期待される結果**: クリップボードコピーが正常に動作する

---

### テスト5: ログの確認（クリップボード警告がないことを確認）

**手順**:

1. エクスプローラーで以下のフォルダを開く:
   ```
   C:\Users\<ユーザー名>\.gaq\logs\
   ```
2. `app.log` をメモ帳で開く
3. 最新のログを確認

**チェック項目**:
- [ ] ログファイルが存在する
- [ ] 「✅ AppleScriptでクリップボードにコピーしました」というログがある
- [ ] **「⚠️ UTF-8デコードエラー」という警告がない**
- [ ] **「⚠️ クリップボード内容が一致しません」という警告がない**

**期待される結果**: クリップボードコピー関連の警告がログに表示されない

---

### テスト6: SSEハートビート機能の確認（長時間音声）

**手順**:

1. 長時間音声ファイル（30分以上、可能であれば180分）を選択
2. 「文字起こし開始」ボタンをクリック
3. 文字起こしが完了するまで待つ（または途中経過を確認）

**チェック項目**:
- [ ] プログレスバーが5%まで進む
- [ ] **約50秒後に「エラー: Load failed」が表示されない**
- [ ] プログレスバーが継続して更新される
- [ ] 文字起こしが最後まで完了する

**期待される結果**: 長時間音声でも「エラー: Load failed」が発生しない

---

### テスト7: ログでSSEハートビートを確認

**手順**:

1. テスト6の実行中または実行後に `C:\Users\<ユーザー名>\.gaq\logs\app.log` を開く
2. ログ内で「ハートビート」を検索

**チェック項目**:
- [ ] 「💓 ハートビート送信」というログが存在する
- [ ] ハートビートが約10秒間隔で送信されている
- [ ] 「📊 進捗送信: X%」というログも存在する

**期待される結果**: SSEハートビートが正常に送信されている

---

## 📊 テスト結果の記録

以下の情報をコピーして、Mac側に報告してください：

### ビルド情報

```
Windows版: <Windowsのバージョン>
Python: <python --version の出力>
PyInstaller: <pyinstaller --version の出力>
ビルド日時: <ビルドした日時>
ビルド結果: 成功 / 失敗
exeファイルサイズ: <ファイルサイズ>
```

### テスト結果

```
テスト1（基本起動）: ✅ 成功 / ❌ 失敗
テスト2（ファイル選択）: ✅ 成功 / ❌ 失敗
テスト3（短時間音声）: ✅ 成功 / ❌ 失敗
テスト4（クリップボードコピー）: ✅ 成功 / ❌ 失敗
テスト5（ログ確認）: ✅ 警告なし / ❌ 警告あり
テスト6（長時間音声）: ✅ 成功 / ❌ 失敗 / ⏸️ 未実施
テスト7（SSEハートビート）: ✅ 確認できた / ❌ 確認できず / ⏸️ 未実施
```

### ログの抜粋

**クリップボードコピー関連のログ**（app.logから抜粋）:

```
（ここに該当するログをコピー＆ペースト）
例:
2025-10-21 XX:XX:XX - __main__ - INFO - 🔔 [Bridge] copy_to_clipboard() が呼び出されました - text length: XXXX
2025-10-21 XX:XX:XX - __main__ - INFO - ✅ AppleScriptでクリップボードにコピーしました (XXXX文字)
```

**SSEハートビート関連のログ**（app.logから抜粋、長時間音声テスト時のみ）:

```
（ここに該当するログをコピー＆ペースト）
例:
2025-10-21 XX:XX:XX - transcribe - DEBUG - 💓 ハートビート送信
2025-10-21 XX:XX:XX - transcribe - DEBUG - 📊 進捗送信: 5%
```

---

## ❓ トラブルシューティング

### ビルドが失敗する場合

**エラー: Pythonが見つかりません**
- Python 3.12.x をインストールしてください
- インストール後、コマンドプロンプトを再起動してください

**エラー: Python 3.12が必要ですが、Python X.X.X が見つかりました**
- Python 3.12.x をインストールしてください
- 複数バージョンがインストールされている場合は、`py -3.12 -m venv venv` で仮想環境を作成してください

### アプリが起動しない場合

1. `app.log` を確認してください（`C:\Users\<ユーザー名>\.gaq\logs\app.log`）
2. エラーメッセージをMac側に報告してください

### クリップボードコピーができない場合

1. `app.log` でエラーを確認してください
2. エラーログをMac側に報告してください

---

## 📝 次のステップ

テスト完了後、以下を実施してください：

1. **テスト結果をMac側に報告**
   - 上記「テスト結果の記録」セクションをコピー
   - ログの抜粋も含める

2. **問題が発生した場合**
   - エラーメッセージのスクリーンショット
   - `app.log` の全文（または該当部分）

3. **すべて正常な場合**
   - Mac側でCodexへの相談（ステップ2）に進む

---

**作成者**: Claude Code
**作成日**: 2025-10-21
